<!DOCTYPE html>
<html lang="es" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Prompts Inmoperfect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados y variables de color */
        :root {
            --bg-light: #FBF9F6; /* Beige claro */
            --bg-dark: #1E1B26; /* Gris oscuro casi negro */
            --text-light: #3D3B40;
            --text-dark: #EAE8ED;
            --primary-light: #D4AF37; /* Ambar/Oro */
            --primary-dark: #F0C419;
            --secondary-light: #E0BBE4; /* Lila claro */
            --secondary-dark: #957DAD; /* Lila oscuro */
            --card-light: #FFFFFF;
            --card-dark: #2D2A37;
            --border-light: #EAE8ED;
            --border-dark: #4A4556;
        }

        .dark-mode-bg { background-color: var(--bg-dark); }
        .light-mode-bg { background-color: var(--bg-light); }
        .dark-mode-text { color: var(--text-dark); }
        .light-mode-text { color: var(--text-light); }
        .dark-mode-card { background-color: var(--card-dark); }
        .light-mode-card { background-color: var(--card-light); }
        .dark-mode-border { border-color: var(--border-dark); }
        .light-mode-border { border-color: var(--border-light); }
        
        .primary-bg { background-color: var(--primary-light); }
        .dark .primary-bg { background-color: var(--primary-dark); }
        .primary-text { color: var(--primary-light); }
        .dark .primary-text { color: var(--primary-dark); }
        
        .secondary-bg { background-color: var(--secondary-light); }
        .dark .secondary-bg { background-color: var(--secondary-dark); }
        .secondary-text { color: var(--secondary-light); }
        .dark .secondary-text { color: var(--secondary-dark); }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .tab-btn {
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary-light);
            color: var(--primary-light);
        }

        .dark .tab-btn.active {
            border-bottom-color: var(--primary-dark);
            color: var(--primary-dark);
        }
        
        .form-select, .form-input {
            transition: all 0.3s ease;
        }
        
        /* Animaci√≥n para el spinner de carga */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            border-top-color: var(--primary-light);
            animation: spin 1s linear infinite;
        }
        .dark .loader {
            border-top-color: var(--primary-dark);
        }

        /* Estilo del scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }
        .dark ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border-dark);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body class="light-mode-bg light-mode-text">

    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="light-mode-card dark:dark-mode-card shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold primary-text dark:primary-text">Inmoperfect</h1>
                    <p class="text-sm text-gray-500 dark:text-gray-400">by C√≠rculo Inmobiliario Secreto</p>
                </div>
                <!-- Dark Mode Toggle -->
                <div class="flex items-center">
                    <span class="text-sm mr-2">‚òÄÔ∏è</span>
                    <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:secondary-bg dark:peer-checked:secondary-bg"></div>
                    </label>
                    <span class="text-sm ml-2">üåô</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto p-4 md:p-8">
            <!-- Tabs -->
            <div class="border-b light-mode-border dark:dark-mode-border mb-6">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="tab-texto" class="tab-btn active text-lg font-medium px-1 py-2 border-b-2 border-transparent">Texto</button>
                    <button id="tab-imagen" class="tab-btn text-lg font-medium px-1 py-2 border-b-2 border-transparent">Imagen</button>
                    <button id="tab-video" class="tab-btn text-lg font-medium px-1 py-2 border-b-2 border-transparent">Video</button>
                    <button id="tab-guardados" class="tab-btn text-lg font-medium px-1 py-2 border-b-2 border-transparent">Guardados</button>
                </nav>
            </div>

            <!-- Tab Panels -->
            <div id="tab-content">
                <!-- Texto Panel -->
                <div id="panel-texto" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulario de Texto -->
                        <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                            <h2 class="text-xl font-semibold mb-4">Define tu necesidad de Texto</h2>
                            <form id="form-texto" class="space-y-4">
                                <select id="texto-objetivo" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="whatsapp">WhatsApp</option>
                                    <option value="email">Email</option>
                                    <option value="copy para Ads">Copy para Ads</option>
                                    <option value="copy para Reels">Copy para Reels</option>
                                </select>
                                <select id="texto-audiencia" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="inversores">A Inversores</option>
                                    <option value="compradores">A Compradores</option>
                                    <option value="arrendatarios">A Arrendatarios</option>
                                </select>
                                <select id="texto-temperatura" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="frio">Contacto en fr√≠o</option>
                                    <option value="tibio">Contacto en tibio / Seguimiento</option>
                                    <option value="caliente">Contacto caliente / Cierre</option>
                                </select>
                                <input type="text" id="texto-ciudad" placeholder="Ciudad (ej. CDMX, Monterrey, Guadalajara)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                <input type="text" id="texto-inmueble" placeholder="Tipo de Inmueble (ej. Apartamento de lujo)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                <textarea id="texto-caracteristicas" rows="3" placeholder="Caracter√≠sticas clave (ej. 3 hab, 2 ba√±os, vistas al mar, piscina comunitaria...)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400"></textarea>
                                <button type="submit" class="w-full primary-bg dark:primary-bg text-white font-bold py-2 px-4 rounded-md hover:opacity-90 transition-opacity">Generar Prompt</button>
                            </form>
                        </div>

                        <!-- Resultado del Prompt y Gemini -->
                        <div class="space-y-6">
                            <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                                <h3 class="text-lg font-semibold mb-2">Prompt Generado</h3>
                                <div class="relative">
                                    <pre id="prompt-texto-resultado" class="whitespace-pre-wrap p-4 rounded-md light-mode-bg dark:dark-mode-bg min-h-[100px]"></pre>
                                    <button onclick="copyToClipboard('prompt-texto-resultado')" class="absolute top-2 right-2 p-1.5 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-semibold">Resultado con Gemini</h3>
                                    <button id="btn-gemini-texto" class="secondary-bg dark:secondary-bg text-white font-bold py-2 px-4 rounded-md hover:opacity-90 transition-opacity disabled:opacity-50" disabled>Generar Respuesta</button>
                                </div>
                                <div id="gemini-texto-resultado-container" class="relative p-4 rounded-md light-mode-bg dark:dark-mode-bg min-h-[150px]">
                                    <div id="gemini-texto-loader" class="absolute inset-0 flex items-center justify-center hidden">
                                        <div class="loader w-8 h-8 border-4 border-gray-200 dark:border-gray-600 rounded-full"></div>
                                    </div>
                                    <div id="gemini-texto-resultado" class="whitespace-pre-wrap"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Imagen Panel -->
                <div id="panel-imagen" class="hidden space-y-6">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulario de Imagen -->
                        <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                            <h2 class="text-xl font-semibold mb-4">Crea una imagen de impacto</h2>
                            <form id="form-imagen" class="space-y-4">
                                <input type="text" id="imagen-inmueble" placeholder="Tipo de espacio (ej. Cocina moderna, fachada de chalet...)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                <select id="imagen-estilo" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="fotorrealista">Fotorrealista</option>
                                    <option value="minimalista">Minimalista</option>
                                    <option value="calido y acogedor">C√°lido y acogedor</option>
                                    <option value="futurista">Futurista</option>
                                    <option value="de lujo">De lujo</option>
                                </select>
                                <textarea id="imagen-elementos" rows="3" placeholder="Elementos clave (ej. Grandes ventanales, isla de m√°rmol, vista al mar...)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400"></textarea>
                                <select id="imagen-iluminacion" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                     <option value="luz de d√≠a brillante">Luz de d√≠a brillante</option>
                                     <option value="golden hour (atardecer)">Golden hour (atardecer)</option>
                                     <option value="iluminaci√≥n nocturna elegante">Iluminaci√≥n nocturna elegante</option>
                                </select>
                                <button type="submit" class="w-full primary-bg dark:primary-bg text-white font-bold py-2 px-4 rounded-md hover:opacity-90 transition-opacity">Generar Prompt</button>
                            </form>
                        </div>

                        <!-- Resultado del Prompt y Nano-Banana -->
                        <div class="space-y-6">
                            <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                                <h3 class="text-lg font-semibold mb-2">Prompt de Imagen Generado</h3>
                                <div class="relative">
                                    <pre id="prompt-imagen-resultado" class="whitespace-pre-wrap p-4 rounded-md light-mode-bg dark:dark-mode-bg min-h-[100px]"></pre>
                                     <button onclick="copyToClipboard('prompt-imagen-resultado')" class="absolute top-2 right-2 p-1.5 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                                 <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-semibold">Imagen con Nano-Banana</h3>
                                    <button id="btn-nanobanana-imagen" class="secondary-bg dark:secondary-bg text-white font-bold py-2 px-4 rounded-md hover:opacity-90 transition-opacity disabled:opacity-50" disabled>Generar Imagen</button>
                                </div>
                                <div id="nanobanana-imagen-resultado-container" class="relative p-4 rounded-md light-mode-bg dark:dark-mode-bg min-h-[250px] flex items-center justify-center">
                                    <div id="nanobanana-imagen-loader" class="absolute inset-0 flex items-center justify-center hidden">
                                        <div class="loader w-8 h-8 border-4 border-gray-200 dark:border-gray-600 rounded-full"></div>
                                    </div>
                                    <img id="nanobanana-imagen-resultado" src="" alt="Imagen generada" class="max-h-full max-w-full rounded-md hidden">
                                    <p id="nanobanana-placeholder" class="text-gray-400">La imagen generada aparecer√° aqu√≠.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Video Panel -->
                <div id="panel-video" class="hidden space-y-6">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulario de Video -->
                        <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                            <h2 class="text-xl font-semibold mb-4">Elabora el guion para tu video</h2>
                            <form id="form-video" class="space-y-4">
                               <select id="video-tipo" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="tour de propiedad">Tour de la propiedad</option>
                                    <option value="gu√≠a del barrio">Gu√≠a del barrio</option>
                                    <option value="actualizaci√≥n del mercado">Actualizaci√≥n del mercado</option>
                                </select>
                                 <select id="video-plataforma" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="Instagram Reels">Instagram Reels</option>
                                    <option value="TikTok">TikTok</option>
                                    <option value="YouTube Shorts">YouTube Shorts</option>
                                    <option value="YouTube (largo)">YouTube (formato largo)</option>
                                </select>
                                <select id="video-tono" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400">
                                    <option value="profesional y informativo">Profesional e informativo</option>
                                    <option value="casual y cercano">Casual y cercano</option>
                                    <option value="energ√©tico y vendedor">Energ√©tico y vendedor</option>
                                </select>
                                <textarea id="video-puntos-clave" rows="4" placeholder="Puntos clave a mencionar (ej. Destacar la cocina renovada, la cercan√≠a a colegios, oferta por tiempo limitado...)" class="w-full p-2 rounded-md light-mode-bg dark:dark-mode-bg border light-mode-border dark:dark-mode-border focus:outline-none focus:ring-2 focus:ring-amber-400"></textarea>
                                <button type="submit" class="w-full primary-bg dark:primary-bg text-white font-bold py-2 px-4 rounded-md hover:opacity-90 transition-opacity">Generar Prompt de Video</button>
                            </form>
                        </div>

                        <!-- Resultado del Prompt de Video -->
                        <div class="light-mode-card dark:dark-mode-card p-6 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border">
                            <h3 class="text-lg font-semibold mb-2">Prompt de Video Generado</h3>
                            <div class="relative">
                                <pre id="prompt-video-resultado" class="whitespace-pre-wrap p-4 rounded-md light-mode-bg dark:dark-mode-bg min-h-[300px]"></pre>
                                 <button onclick="copyToClipboard('prompt-video-resultado')" class="absolute top-2 right-2 p-1.5 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Guardados Panel -->
                <div id="panel-guardados" class="hidden space-y-4">
                    <h2 class="text-2xl font-bold mb-4">Historial de Prompts</h2>
                    <div id="lista-guardados" class="space-y-3">
                        <!-- Los prompts guardados se insertar√°n aqu√≠ -->
                        <p class="text-gray-500">A√∫n no has generado ning√∫n prompt.</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="light-mode-card dark:dark-mode-card mt-auto py-4">
            <div class="container mx-auto px-4 text-center text-gray-500 dark:text-gray-400">
                <p>&copy; 2025 Hecho por C√≠rculo Inmobiliario Secreto</p>
            </div>
        </footer>
        
        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-md shadow-lg opacity-0 transform translate-y-2 transition-all duration-300">
            ¬°Prompt copiado!
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const panels = {
                'tab-texto': document.getElementById('panel-texto'),
                'tab-imagen': document.getElementById('panel-imagen'),
                'tab-video': document.getElementById('panel-video'),
                'tab-guardados': document.getElementById('panel-guardados'),
            };

            // --- State Management ---
            let currentTextPrompt = '';
            let currentImagePrompt = '';

            // --- Tab Navigation ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    Object.values(panels).forEach(p => p.classList.add('hidden'));
                    panels[tab.id].classList.remove('hidden');
                    if (tab.id === 'tab-guardados') {
                        loadSavedPrompts();
                    }
                });
            });
            
            // --- Dark Mode ---
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const htmlElement = document.documentElement;

            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                htmlElement.classList.add('dark');
                darkModeToggle.checked = true;
            }

            darkModeToggle.addEventListener('change', () => {
                if (darkModeToggle.checked) {
                    htmlElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    htmlElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
            });

            // --- Prompt Generation ---
            // Formulario de Texto
            document.getElementById('form-texto').addEventListener('submit', (e) => {
                e.preventDefault();
                const objetivo = document.getElementById('texto-objetivo').value;
                const audiencia = document.getElementById('texto-audiencia').value;
                const temperatura = document.getElementById('texto-temperatura').value;
                const ciudad = document.getElementById('texto-ciudad').value || '[Ciudad]';
                const inmueble = document.getElementById('texto-inmueble').value || '[Tipo de Inmueble]';
                const caracteristicas = document.getElementById('texto-caracteristicas').value || '[Caracter√≠sticas]';

                const prompt = `Act√∫a como un experto en copywriting inmobiliario. Genera 3 variantes de un mensaje para ${objetivo} dirigido a ${audiencia}. El objetivo es un ${temperatura}. El mensaje debe ser profesional, persuasivo y crear un sentido de urgencia sutil.
                
Informaci√≥n del inmueble:
- Tipo: ${inmueble}
- Ubicaci√≥n: ${ciudad}
- Caracter√≠sticas principales: ${caracteristicas}

Adapta el tono y la estructura seg√∫n el canal (${objetivo}). Si es para WhatsApp, usa un lenguaje m√°s directo y cercano, con emojis. Si es para email, s√© un poco m√°s formal y estructurado.`;

                document.getElementById('prompt-texto-resultado').textContent = prompt;
                currentTextPrompt = prompt;
                document.getElementById('btn-gemini-texto').disabled = false;
                savePrompt(prompt, 'Texto');
            });

            // Formulario de Imagen
            document.getElementById('form-imagen').addEventListener('submit', (e) => {
                e.preventDefault();
                const inmueble = document.getElementById('imagen-inmueble').value || 'un espacio interior de lujo';
                const estilo = document.getElementById('imagen-estilo').value;
                const elementos = document.getElementById('imagen-elementos').value;
                const iluminacion = document.getElementById('imagen-iluminacion').value;

                const prompt = `Imagen ${estilo} de alta calidad de ${inmueble}. ${elementos}. La iluminaci√≥n es ${iluminacion}, creando una atm√≥sfera de lujo y exclusividad. La imagen debe ser muy detallada, con texturas realistas. Estilo de fotograf√≠a de arquitectura profesional, cinematic, 8k.`;
                
                document.getElementById('prompt-imagen-resultado').textContent = prompt;
                currentImagePrompt = prompt;
                document.getElementById('btn-nanobanana-imagen').disabled = false;
                savePrompt(prompt, 'Imagen');
            });
            
             // Formulario de Video
            document.getElementById('form-video').addEventListener('submit', (e) => {
                e.preventDefault();
                const tipo = document.getElementById('video-tipo').value;
                const plataforma = document.getElementById('video-plataforma').value;
                const tono = document.getElementById('video-tono').value;
                const puntosClave = document.getElementById('video-puntos-clave').value || '[Puntos Clave]';

                const prompt = `Act√∫a como un guionista experto en contenido inmobiliario para redes sociales. Crea un guion detallado para un video tipo "${tipo}" destinado a ${plataforma}. El tono debe ser ${tono}.

El guion debe incluir:
1.  **Hook inicial (primeros 3 segundos):** Algo que capte la atenci√≥n inmediatamente.
2.  **Cuerpo del video:** Descripci√≥n de las escenas, qu√© mostrar en c√°mara y el texto que debe decir el narrador o agente.
3.  **Puntos clave a cubrir:** Aseg√∫rate de integrar de forma natural lo siguiente: ${puntosClave}.
4.  **Llamada a la acci√≥n (CTA):** Qu√© debe hacer el espectador al final del video.
5.  **Sugerencias de m√∫sica y texto en pantalla.**

El video no debe durar m√°s de ${plataforma.includes('Shorts') || plataforma.includes('Reels') || plataforma.includes('TikTok') ? '60 segundos' : '3 minutos'}.`;
                
                document.getElementById('prompt-video-resultado').textContent = prompt;
                savePrompt(prompt, 'Video');
            });

            // --- API Calls ---
            const apiKey = ""; // API Key will be handled by the environment

            // Gemini Text Generation
            document.getElementById('btn-gemini-texto').addEventListener('click', async () => {
                if (!currentTextPrompt) return;
                
                const loader = document.getElementById('gemini-texto-loader');
                const resultDiv = document.getElementById('gemini-texto-resultado');
                const button = document.getElementById('btn-gemini-texto');

                loader.classList.remove('hidden');
                resultDiv.textContent = '';
                button.disabled = true;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: currentTextPrompt }] }] })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error en la API: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || 'No se pudo obtener una respuesta.';
                    resultDiv.textContent = text;

                } catch (error) {
                    resultDiv.textContent = `Error: ${error.message}`;
                    console.error(error);
                } finally {
                    loader.classList.add('hidden');
                    button.disabled = false;
                }
            });
            
            // Nano-Banana Image Generation
            document.getElementById('btn-nanobanana-imagen').addEventListener('click', async () => {
                if (!currentImagePrompt) return;

                const loader = document.getElementById('nanobanana-imagen-loader');
                const resultImg = document.getElementById('nanobanana-imagen-resultado');
                const placeholder = document.getElementById('nanobanana-placeholder');
                const button = document.getElementById('btn-nanobanana-imagen');
                
                loader.classList.remove('hidden');
                resultImg.classList.add('hidden');
                placeholder.classList.add('hidden');
                button.disabled = true;

                try {
                     const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: currentImagePrompt }] }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        })
                    });

                    if (!response.ok) throw new Error(`Error en la API: ${response.statusText}`);

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    
                    if (base64Data) {
                        resultImg.src = `data:image/png;base64,${base64Data}`;
                        resultImg.classList.remove('hidden');
                    } else {
                        placeholder.textContent = 'No se pudo generar la imagen. Int√©ntalo de nuevo.';
                        placeholder.classList.remove('hidden');
                    }

                } catch (error) {
                    placeholder.textContent = `Error: ${error.message}`;
                    placeholder.classList.remove('hidden');
                    console.error(error);
                } finally {
                    loader.classList.add('hidden');
                    button.disabled = false;
                }
            });

            // --- Local Storage for Saved Prompts ---
            function savePrompt(prompt, type) {
                let saved = JSON.parse(localStorage.getItem('inmoperfect_prompts')) || [];
                saved.unshift({ prompt, type, date: new Date().toISOString() });
                if (saved.length > 50) saved.pop(); // Limitar a 50 prompts
                localStorage.setItem('inmoperfect_prompts', JSON.stringify(saved));
            }

            function loadSavedPrompts() {
                const saved = JSON.parse(localStorage.getItem('inmoperfect_prompts')) || [];
                const container = document.getElementById('lista-guardados');
                container.innerHTML = '';

                if (saved.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">A√∫n no has generado ning√∫n prompt.</p>';
                    return;
                }

                saved.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'light-mode-card dark:dark-mode-card p-4 rounded-lg shadow-sm border light-mode-border dark:dark-mode-border flex justify-between items-start';
                    
                    const typeColor = item.type === 'Texto' ? 'text-blue-400' : item.type === 'Imagen' ? 'text-purple-400' : 'text-green-400';

                    div.innerHTML = `
                        <div>
                            <span class="font-bold ${typeColor}">${item.type}</span>
                            <p id="saved-prompt-${index}" class="text-sm mt-1 whitespace-pre-wrap">${item.prompt}</p>
                        </div>
                        <div class="flex flex-col space-y-2 ml-4">
                             <button onclick="copyToClipboard('saved-prompt-${index}')" class="p-1.5 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            </button>
                             <button data-index="${index}" class="delete-prompt-btn p-1.5 rounded-md bg-red-200 dark:bg-red-800 hover:bg-red-300 dark:hover:bg-red-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-700 dark:text-red-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
                // Add event listeners for delete buttons
                document.querySelectorAll('.delete-prompt-btn').forEach(button => {
                   button.addEventListener('click', (e) => {
                       const index = e.currentTarget.getAttribute('data-index');
                       deletePrompt(index);
                   })
                });
            }
            
            function deletePrompt(index) {
                let saved = JSON.parse(localStorage.getItem('inmoperfect_prompts')) || [];
                saved.splice(index, 1);
                localStorage.setItem('inmoperfect_prompts', JSON.stringify(saved));
                loadSavedPrompts();
            }

        });

        // --- Utility Functions ---
        function copyToClipboard(elementId) {
            const textToCopy = document.getElementById(elementId).textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                showToast('¬°Prompt copiado!');
            } catch (err) {
                console.error('Error al copiar:', err);
            }
            document.body.removeChild(tempTextArea);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('opacity-0', 'translate-y-2');
            toast.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => {
                toast.classList.remove('opacity-100', 'translate-y-0');
                toast.classList.add('opacity-0', 'translate-y-2');
            }, 2000);
        }
    </script>
</body>
</html>
